def bin(pixel):
    return 1 if pixel == "#" else 0

algorithm_neighbors = [[-1, -1], [-1, 0], [-1, 1],
                        [0, -1], [0, 0], [0, 1],
                        [1, -1], [1, 0], [1, 1]]

def load_pixel(input_image, boundary_color, height, width, y, x):
    if y < 0 or y >= height or x < 0 or x >= width:
        return boundary_color
    else:
        return input_image[y][x]

def enhance_image(input_image, boundary_color):
    # While the image is infinite, the final resulting image will only
    # be 1 pixel wider/taller on each end than the current image.
    # This is because beyond that, the image will be entirely uniform.

    height = len(input_image)
    width = len(input_image[0])
    result_image = [[0 for x in range(width + 2)] for y in range(height + 2)]
    for y in range(0 - 1, height + 1):
        for x in range(0 - 1, width + 1):
            lookup = 0
            for dy, dx in algorithm_neighbors:
                lookup += load_pixel(input_image, boundary_color, height, width, y + dy, x + dx)
                lookup *= 2
            lookup //= 2
            result_image[y+1][x+1] = image_enhancement_algorithm[lookup]
    return result_image


image_enhancement_algorithm = "#.#....########.......##..##.#.#####...#..#..##.###.##.#..##.....#.#....#...####.#...#.##.#.#.#....###...#.##.#...#.#....#...#.#..#....###.##.....#.######.#.##.#..####..#...#.##.##...#....###..#.##..###..#..#.....#.###.##....##...#....###.#.......#.#####...#.##..###....##.#.##..##.######...##..##.#..###.###.....###...##.##.#..#...##..#.###..#..###..##...#...#.#..#..#..##....###...........###.#....#######...#####.#..##...#..#....##.##.#.###...####...#.#..#...#.##.#.#..#.###.#.#####.#.##.###.##..#..#...###.#."
image_enhancement_algorithm_sample = "..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..###..######.###...####..#..#####..##..#.#####...##.#.#..#.##..#.#......#.###.######.###.####...#.##.##..#..#..#####.....#.#....###..#.##......#.....#..#..#..##..#...##.######.####.####.#.#...#.......#..#.#.#...####.##.#......#..#...##.#.##..#...##.#.##..###.#......#.#.......#.#.#.####.###.##...#.....####.#..#..#.##.#....##..#.####....##...##..#...#......#.#.......#.......##..####..#...#.#.#...##..#.#..###..#####........#..####......#..#"
image_enhancement_algorithm = list(map(bin, image_enhancement_algorithm))
print(image_enhancement_algorithm)

input_image = """...............
...............
...............
...............
...............
.....#..#......
.....#.........
.....##..#.....
.......#.......
.......###.....
...............
...............
...............
...............
..............."""
input_image = """.#.#.##.#######..#..#..#.#.#...###.###.##..##..##.###..#.#...##..##....##....#..####.#.###..#.#.#..#
#..###.##.........#..#.#...#......###..##.#.####....#..#..###.#.#######...###..#.#.##.#..##.#.#.....
.###..##.##..#.#.####.#.##..##.#.##.#..#####.#..#....#....#....#...#.##..###.#.####...##..##.##.#...
##....##....#.#.#...#..####..#..#.#.#.##.#.#.##..##.#..#...#..##...##...#.#.##.....##.####....#.....
#......#....#.###.##...#.#..#.#.#.##..###..##..###.##..##...####..#.#.#..##..#..#.#.#...###.......##
##.##...###.#.##..#######..#.###.###.##.....#.#...###..#####...#.###.#.#######.##....#.#.###..##..#.
..#.###....#.#.#..##..#.###.#.##.###.#..##.#...#...#......#####......###.##..#..##....#....#...#...#
#.##.##...#.#.#.#..##..#.#.##.#...#.###..#.####.##.#.#..#####...####..##..##..#.####.###..####.#..##
#####...#.####....##....##.........#.###.#...#..###.#........#.###.#...#.#.###########..#####..##...
..#.####..##.##.#..#.#####.##.#.#.#..######..####.#.#.#.##...#.#.#.#..##..###.###...#.....#.###...##
..#.....#.#.#..##..####.###.##.#.##.#.#...#.#####.#.#....##.#.#....##.#.##.#.##.##.#.#...#.....##.##
#..##....##...##...######.####.##....#..#.#.###.#.###..#.###......##.###....######.##.#...##...###..
##..#....###.##..#.#..########......##..#.#.##...#.##.#..#..#.##.###.#...#....#.##.#..#####.#..#.#.#
..#..#..######..#.##......#....#.#.#..#.##.##..##...#....###.##..#..###.##..##......##..#.#..###.##.
....#.####.##.#####.###.##..#.#####.###.....#.#..#########.##.##..###.##.#.#..#.....#####.###.#.#..#
...#..#.#.#.#.#.#######...#.#.####.##..##.....##..#####..#..#.##.#..##...#.##.##..#..........##.#.##
...#.###.##.####...##.###.#####.####.....##.#.##...#..#..###.###.#.........###.#####.....#.##..#.#..
.##.#.#.#.....#.#.##.#.#....#.###..####...#....##.#.#####.#...##...####..#...#######...####..#....##
##.#.###.#..###..###...####.#.###.####...#..#.##.......#...#.#........#..#..##.....#.##...###.#..#..
##.#.#..#........##..######.#######.######..##.#..##.#......#.###.#..#..##..###.........#.#######.#.
#.###.###...#.#.##.#########....#..#.#####.#.##.##..#..#.#.....##.#..###.#....###.###...#.#...##..#.
#.##.####..##....##...#.#...#.##.#..##.###..##..#####.#...#.#.......#..#.###....#..#..##.....#.###..
#.###.#.#.#...##..#.#.##...###..#.##........#.##.####.#..####.#.#.###.##....#.##.######.####.###....
.####...#..#..#.#..####..##..#.#.....##.#..##...#.#.#.#...##....#......##...#..#.###.#...##..#.####.
..####...#.#....###..#.#..#....##..#..#.#..####.#.##..##.###...##..#..#######.#.#######......####...
#.#..#..###.#.##.###..###.##.#.###.#####.#..#.#####.#.##.#..#.########..###..#...#.###..##..#.#..###
######...#....#....#......#......#.##.######...#.......#..#..##..#..##.#..#..####..##....##.##..#.#.
#....###.#.######.###..##.#..###..#..#..###.#.....#.#.##..###..#.#..##.###.#..#..#.#.#..##.##.#.####
#..#..#####.##...##.#..#######.#.#.#..###.#.##.###..#....####...####..##..##..#...#...#..#..#.#..#..
...#....##...####.#.##.#.#.#.......#..##....###.##..#...##...##.#.#.#.#.###..###..##..#.....##....##
#.#.#######..###...###.##.#..#..###.#####.###.#.#..##...#.##..####...##..#.##...#.##.#####.##.......
.#...#......##..#.#.##...###.##.#.##....####.##.#####.##.#..#.#..##....#.#.#..######....#.###.#####.
#..#.##..###..#.##.#....##..#.#..#..##..##...#...####..........#...#...###.#.#..#...#..###.##.#.##..
...#...#.#...#..#.#.###.#.#.#.#..##..##.#######...#.######....#.#.###.#.#.##.#.#.###.###.##.###..###
#.##....#.#.....#..###..#####.#..#..##.###....#.###....#.#####.###.#.######.....#..#.#..###..#.....#
....#..#..#.#.....#####.....###.....##.##.#..##....#...#...###...#..##..#..#####..##.#.#..#.#...####
#.#####...#.##..#..##..#.##.#..##........#...#....#.#....###.#.#...##.##.#####..###..##.#.#.#.#.####
#.###.####.#...#..##########..#.###..#.#.###...#.##..#####.###..#..###....##.##...#..###.##.#..#.##.
##.######.###.#...##..###.#.#.#.###.#.##....####..#.#.###.#...#..##.#####...##..###.#..##..####.....
#.#.....##...#.###.#.###.#.##.#.###....#.##.....##....####.####.##.#...#.....#..#####..#.#....###.##
###..##.#....####.#####.#.#..#..#....###.###.#..####.#.####..###.#.#...###.##........#.#####.#.##..#
##.#.###.###.......###.#.##.#..#.##.####.###....#..#.#.#...##....##..#....###.#####..###...##.#.##..
.#..###.#...#...#..#..##...##.#...#######...#..#.##..####..##...##.##.##.###.####...##.....#...#.###
#.##.........##..#..###..#....#.###..##..#.##.....##.###.....##..#.#.#######...#...#.....#..##..#..#
##..#.###.#...#.##...#.#..###.##...#...#####.####...###.#..##.##..#.##.#.#..#####.#...##..####...#..
..#.#.........#####.##..###.#.#.#..#.##...##.#..##.#..####.##.#.###.#.#.###.##...#.##....#.#######.#
###..#..#.#.#...#.###.#####.#.#.######.....##.#.##.#.#...#..#.#.##..###.#..###.####...##..####......
#..#..#.#....###.#.##..#.#.#.#.##..#..##.......#..#.#.......##...####.#.#..###...........#...#.#.#.#
#....##..##..#.##...###.#..#.#####.#.#.###.#.#..######.....#.#####....#.#..####..#.##.#####..#...#..
.##.###..##......###.....#.#.##...#..####.#..#...#..###.####.#..####.#...#.######.#.#..#####.....##.
#...###.###...##.#####..###.###.#####.###.#..###.#..#######..#..#####....#..##...######...##.#....##
###.#.#.#.#####..#####.#..##.#.###...####.#.#.#..#.#......#...#....#...#.#..#..#...#...##..#..##..##
.####....##..##.###..#.######...#.#..#.##..#..##.###.#.##.#...###.#.#.#....#.####.#.#....##.#####..#
##..##...###.#.#.#####..#.##..#####.####.##.#..#..####..#..##.##..###..###.....#.#.#.#####...#.###.#
###.####.##....#.##.#....#..###..##.##..#.....#.###....#.######...##.....#.##.##..###.####.#.###.#.#
#.#....#.#.#.#.#..##.##.##..##..##..####.#.#.#..##.#####..#####...#.#..##....#######.###..##..######
.#.....#.#..####.###..###...###.##....#.#.#.#..##.##...##..#.########..#.#...#..#.#..#.##.#.#.###.#.
#..#.####..####.##..##.##..#..##.####..#..##...#.##..#..#.###.#....#####..##.#######.#.###..#.#....#
.##.#....####....#.##.###..#..#..###.#.#.##.#..##.###....#######.####..#.########.#.....##.#...##..#
#.###..#.#.........#.#.#....########.####..###......##..#.##.#.#..######.#.###..#...####...##.##.#..
#.###.#..###...##.#......##..#..##.#..###..#.####...#.#..#...#.#####..##.###..##.##.#.#...#.#...#.##
##.###..#..#.#.##.##.##...###..#..#.#.#..#...###..#.#...#..#####.####...########.#...#.#.#.###.##...
.#####..#..#..####.#..#.....##.##....###...##.####.#.####.#..#####..#.#..#.##.###.#..##..###..#..#..
.#.#....#.####.#.###.#.###.####.#.##.#......##...#...#..###.###.#..##...#.#.#..##.##.#####.##.###..#
.##..###.##..#####.##.#....###...##....##..###.##.########.#.....#..##..#...#.#.#.###..#...#.#.#...#
#.####...####.###.#.#.###.###.#####.#...###.####..#..#..####.###..#.#..#.##.###..#.......#.#..##.#..
...#.###....#...###.#.###.#.#.#...#.##......#..###..###.#.#.#..###.##..#.#.#..#..##..#.#..###.##.#.#
#..#....#..####....####...#..######.#.#..##.#.##.###.#.#..##.#.....###..#....##......##.####..#.#..#
##..##......#..##..#..##.##.##..#..#.#...####.#.##...##.#.##.#..#...##..##.##..#..####..#..#..#..##.
#.####.#######.....##.#..##....#..#.#......###..##.##..##..#.#.#.#..##..#.#.....#......#.#.#.#....#.
....##.###...#...###..#..#.##...#.#.#.##...##....####..#..##..#.##.##...##..##....#...###.#.##....#.
..#..###.#.###.#.#.#...####...###.#..#.#.#...#.#.......##..#....##..#.##.##..##..#..####.#.#.......#
##.##.##.#....#.#..###.####..##..#..######..#.###.###.#####......#.#...#.#.....#####...#....#.###...
.#...##.##.#..#.##..###..#.######...#..#....#.#....#..###....#.#.#.##...#####.#..#...#..#..###......
.#......####....#.#...#.#.##.###.#..#..####.#...####..#####.##.#...#.#.#.##.##...#.#.#.##.#.##...###
..###..#####.#....##..#..#.###...#..##..##.#......#..####.#.###.#...#....###.#.##..####.#.####.###..
..##..#.#.#.#.##.####...#..#..#..#.##..#...##.#.##.#.###.###.#.#.##...#.#######.#.#.....####........
##.###.#.#.#..#..##..##.##.##.###...#...##..#.##.....#.#..#.##.#.#.###...##.####..##..##..#.#....#..
..#.##.#.##.###...###..#..#...##....#..#......####.##...#####...#...#.####.##.###.....#..#.#..##.##.
#..######.#.#..##...##.#.#..##...##.####.#######..#..#..###.##..#..#...#....#..#.##....###...#.#.##.
..#.#.#....####.#.#.........#..#.#..##..####...#.####...#..#.#...###.####..##......#..#...#.##.##.#.
.####.##..##.####..#.#.##..####.#.#......##.##...####.####.#..#...##.#..######.#.##.#.##.##.#.#.##.#
.#....##...#..###..#.#..#.##..#.####.#..###..##..#####..#..#.#.##..#.....#..###.....###.#.##.#.##.#.
...##...#...#..#..........#######......##.##.#.##.##.#..#.##.###.###..#..#....##..#.###.#..#...#####
.#####...#.##.....####.###.#.#..#....#...##..#....###.#.##.##########.#.#...#.####.......#..#...#.#.
.#....#.####.##.#.###..#.###.#....#.###..##...###...#.....###..####...#..##.#..##.#....###.#....#.#.
.##..###........#.#.##..##.##.##..#..####.#.#.##.##.#..#.#..#######.....######.#.#..#..###....#.##.#
..#.##..#...##.######..#..##.###...#.#.####..####..#.#...#.....##...##.#..##.#..#..#.###.##..#.#....
..#.###.###.#..#####....#...#..#...#..#.##..##..#.####..#..#.##.#.##..#######...##.#.#.#..#.##..###.
###.##..#..#...#####.#....#.#...#..###..##...##...#...#...#.###.#..#..#########..##.....#....#.#...#
#..##.#....#..####..###.#.#.#.##.###.#..#.###.##....##.#.#..#..#.#.#..###..##.#.#.#..#..#.#.###..###
#.#.#.###..#.#.#.....###.#.#....#.#####....##.###.##....#.......#..###.#.#..###..####.#.....####....
#####.####.#.#..#####.#.#....#....#......####.####.#.###.##..#...#.#..##.##.#########.###.#.#.#.#.##
.....#.##.##.#####...#.##...#...##########.###....##..####...#..####.##..###.#.#######.##...##.###..
#.#..##..#..##...........####.#....##.##.#..#.##..####.#..#.#..#...#...###.###.#...##.#.#.##.#..###.
.#####.#.#.#######.##..#..#..#..###.###.#..####..#.##....#.#..#.##.##.##.#########......####..#.##.#
.#....###..#.###.##.#...#.#...#...#.####...#.......#..###..####.####..#.####.##.#.##...###.###....#.
##......##.....#####.#.#.#......#.#.#.#.###.######.....#.##.#..#.#######.###.########..####..#.###.#
###.##....###..#.#####..#..####..#.......##.##.#.##.#.#.#.#..#......####..###..####.##.#.......#.#.#
#..###.###..#..##.#####.##.#....##.###.###....#######.#...#.#.#.#..#######...#.....#..##.####.###.##"""
input_image = [list(map(bin, line)) for line in input_image.splitlines()]
print(input_image)

#I manually fudge boundary_color since my real input flips background color but my test input doesn't.
# result_image = enhance_image(enhance_image(input_image, 0), 1)

result_image = input_image
for i in range(0,50):
    result_image = enhance_image(result_image, i % 2)

print(result_image)
print("\n".join([
    "".join(["#" if pixel else "." for pixel in line])
    for line in result_image]))

print(sum([
    sum([pixel for pixel in line])
    for line in result_image]))