CREATE TEMPORARY TABLE IF NOT EXISTS vents(
	x INT,
	y INT,
	overlap INT
);

CREATE INDEX ON vents(x,y);
CREATE INDEX ON vents(y,x);

TRUNCATE vents;
INSERT INTO vents(x, y, overlap)
	SELECT x, y, 0
		FROM (SELECT y FROM generate_series(0, 1000) as s(y)) y
		LEFT JOIN (SELECT x FROM generate_series(0, 1000) as s(x)) x
		ON 1=1;
	  --WHERE y = 1;

CREATE OR REPLACE FUNCTION add_vents(x1 INT, y1 INT, x2 INT, y2 INT)
RETURNS INT as $$
DECLARE x_min INT := CASE WHEN x1 <= x2 THEN x1 ELSE x2 END;
DECLARE x_max INT := CASE WHEN x1 <= x2 THEN x2 ELSE x1 END;
DECLARE y_min INT := CASE WHEN y1 <= y2 THEN y1 ELSE y2 END;
DECLARE y_max INT := CASE WHEN y1 <= y2 THEN y2 ELSE y1 END;
BEGIN
	UPDATE vents
		SET overlap = overlap + 1
		WHERE x BETWEEN x_min AND x_max
		AND y BETWEEN y_min AND y_max;
	RETURN x_min;--(SELECT COUNT(*) FROM vents WHERE x = x_min);
END
$$ LANGUAGE plpgsql;

SELECT add_vents(964,133,596,133);
SELECT add_vents(920,215,920,976);
SELECT add_vents(123,528,123,661);
SELECT add_vents(613,13,407,13);
SELECT add_vents(373,876,424,876);
SELECT add_vents(616,326,120,326);
SELECT add_vents(486,335,539,388);
SELECT add_vents(104,947,54,947);
SELECT add_vents(319,241,282,204);
SELECT add_vents(453,175,453,438);
SELECT add_vents(485,187,915,617);
SELECT add_vents(863,605,603,605);
SELECT add_vents(870,524,342,524);
SELECT add_vents(967,395,634,62);
SELECT add_vents(405,181,807,181);
SELECT add_vents(961,363,419,905);
SELECT add_vents(89,586,214,461);
SELECT add_vents(545,481,731,295);
SELECT add_vents(407,678,626,678);
SELECT add_vents(421,642,91,312);
SELECT add_vents(11,22,935,946);
SELECT add_vents(770,208,76,902);
SELECT add_vents(668,858,668,890);
SELECT add_vents(568,451,574,451);
SELECT add_vents(233,56,371,56);
SELECT add_vents(233,932,44,932);
SELECT add_vents(404,81,796,81);
SELECT add_vents(520,77,403,194);
SELECT add_vents(296,736,447,887);
SELECT add_vents(210,909,16,909);
SELECT add_vents(692,483,877,668);
SELECT add_vents(777,289,744,289);
SELECT add_vents(22,760,652,130);
SELECT add_vents(96,360,626,360);
SELECT add_vents(101,267,101,783);
SELECT add_vents(47,667,660,667);
SELECT add_vents(805,682,563,440);
SELECT add_vents(112,15,463,366);
SELECT add_vents(406,808,430,808);
SELECT add_vents(793,767,107,81);
SELECT add_vents(560,534,958,534);
SELECT add_vents(722,429,722,459);
SELECT add_vents(646,889,646,195);
SELECT add_vents(433,942,449,958);
SELECT add_vents(716,503,716,99);
SELECT add_vents(266,450,266,780);
SELECT add_vents(316,81,565,81);
SELECT add_vents(760,452,687,452);
SELECT add_vents(976,983,15,22);
SELECT add_vents(499,564,499,909);
SELECT add_vents(839,913,38,112);
SELECT add_vents(707,333,438,333);
SELECT add_vents(47,644,352,644);
SELECT add_vents(807,309,807,706);
SELECT add_vents(434,686,812,308);
SELECT add_vents(559,572,63,76);
SELECT add_vents(493,352,581,352);
SELECT add_vents(94,88,928,88);
SELECT add_vents(898,738,106,738);
SELECT add_vents(201,10,564,10);
SELECT add_vents(976,914,976,472);
SELECT add_vents(836,153,585,153);
SELECT add_vents(178,43,17,204);
SELECT add_vents(784,967,738,967);
SELECT add_vents(370,359,449,359);
SELECT add_vents(13,526,637,526);
SELECT add_vents(399,158,10,158);
SELECT add_vents(572,293,289,293);
SELECT add_vents(627,674,895,674);
SELECT add_vents(921,402,984,402);
SELECT add_vents(907,667,944,704);
SELECT add_vents(574,877,882,569);
SELECT add_vents(977,977,121,121);
SELECT add_vents(550,584,862,584);
SELECT add_vents(396,556,396,289);
SELECT add_vents(391,33,532,174);
SELECT add_vents(12,988,989,11);
SELECT add_vents(48,787,48,637);
SELECT add_vents(476,638,113,638);
SELECT add_vents(985,985,13,13);
SELECT add_vents(838,784,198,784);
SELECT add_vents(567,195,677,305);
SELECT add_vents(174,251,577,654);
SELECT add_vents(296,801,53,558);
SELECT add_vents(983,899,983,380);
SELECT add_vents(507,230,507,929);
SELECT add_vents(264,516,668,920);
SELECT add_vents(865,952,865,768);
SELECT add_vents(522,290,744,512);
SELECT add_vents(936,958,936,115);
SELECT add_vents(527,871,527,519);
SELECT add_vents(944,972,21,49);
SELECT add_vents(880,380,695,565);
SELECT add_vents(471,374,446,349);
SELECT add_vents(503,597,127,221);
SELECT add_vents(471,514,30,73);
SELECT add_vents(890,232,890,511);
SELECT add_vents(14,461,14,853);
SELECT add_vents(167,676,148,676);
SELECT add_vents(987,230,754,230);
SELECT add_vents(797,725,797,847);
SELECT add_vents(347,21,84,21);
SELECT add_vents(839,274,964,274);
SELECT add_vents(607,456,894,456);
SELECT add_vents(335,949,301,949);
SELECT add_vents(167,236,820,889);
SELECT add_vents(87,558,87,917);
SELECT add_vents(318,788,622,484);
SELECT add_vents(699,583,699,321);
SELECT add_vents(971,967,35,31);
SELECT add_vents(420,44,420,36);
SELECT add_vents(29,484,458,484);
SELECT add_vents(768,157,768,30);
SELECT add_vents(690,839,317,839);
SELECT add_vents(870,578,560,578);
SELECT add_vents(697,195,70,822);
SELECT add_vents(689,45,689,223);
SELECT add_vents(790,724,341,724);
SELECT add_vents(694,291,694,507);
SELECT add_vents(43,339,43,987);
SELECT add_vents(590,733,590,179);
SELECT add_vents(751,361,945,361);
SELECT add_vents(99,820,450,469);
SELECT add_vents(460,696,942,696);
SELECT add_vents(783,940,487,644);
SELECT add_vents(630,537,48,537);
SELECT add_vents(643,856,643,396);
SELECT add_vents(558,733,257,432);
SELECT add_vents(16,972,570,418);
SELECT add_vents(636,188,636,610);
SELECT add_vents(868,138,868,407);
SELECT add_vents(85,424,85,919);
SELECT add_vents(710,932,354,576);
SELECT add_vents(356,505,783,505);
SELECT add_vents(606,876,606,62);
SELECT add_vents(577,431,749,431);
SELECT add_vents(108,262,108,145);
SELECT add_vents(615,455,264,104);
SELECT add_vents(205,754,866,754);
SELECT add_vents(189,182,855,848);
SELECT add_vents(10,43,925,958);
SELECT add_vents(293,773,293,534);
SELECT add_vents(746,313,802,369);
SELECT add_vents(607,174,211,570);
SELECT add_vents(860,840,260,240);
SELECT add_vents(879,78,595,78);
SELECT add_vents(11,143,449,143);
SELECT add_vents(190,983,267,983);
SELECT add_vents(912,92,76,928);
SELECT add_vents(744,364,744,258);
SELECT add_vents(436,417,46,807);
SELECT add_vents(629,592,517,592);
SELECT add_vents(113,893,113,959);
SELECT add_vents(714,213,786,285);
SELECT add_vents(868,165,868,731);
SELECT add_vents(349,69,491,69);
SELECT add_vents(278,430,111,263);
SELECT add_vents(593,849,593,203);
SELECT add_vents(156,860,876,860);
SELECT add_vents(169,615,169,984);
SELECT add_vents(983,93,139,937);
SELECT add_vents(94,548,18,548);
SELECT add_vents(623,72,106,589);
SELECT add_vents(530,334,473,334);
SELECT add_vents(384,746,925,205);
SELECT add_vents(711,74,28,757);
SELECT add_vents(850,728,629,949);
SELECT add_vents(378,801,228,651);
SELECT add_vents(347,968,201,822);
SELECT add_vents(82,578,82,555);
SELECT add_vents(149,405,707,963);
SELECT add_vents(254,169,793,169);
SELECT add_vents(443,454,331,454);
SELECT add_vents(460,659,608,807);
SELECT add_vents(838,807,31,807);
SELECT add_vents(561,952,290,952);
SELECT add_vents(755,626,204,75);
SELECT add_vents(550,424,550,81);
SELECT add_vents(772,115,772,600);
SELECT add_vents(40,517,40,232);
SELECT add_vents(277,841,317,841);
SELECT add_vents(899,150,128,921);
SELECT add_vents(735,332,465,332);
SELECT add_vents(839,254,915,330);
SELECT add_vents(959,616,182,616);
SELECT add_vents(729,723,487,965);
SELECT add_vents(64,838,953,838);
SELECT add_vents(689,830,689,982);
SELECT add_vents(191,83,191,879);
SELECT add_vents(522,833,942,833);
SELECT add_vents(877,785,877,346);
SELECT add_vents(255,95,556,95);
SELECT add_vents(782,491,475,798);
SELECT add_vents(268,815,812,271);
SELECT add_vents(119,181,905,181);
SELECT add_vents(445,457,742,160);
SELECT add_vents(973,30,27,976);
SELECT add_vents(356,681,356,289);
SELECT add_vents(882,279,914,279);
SELECT add_vents(672,162,672,153);
SELECT add_vents(180,729,357,729);
SELECT add_vents(985,716,985,313);
SELECT add_vents(191,618,191,963);
SELECT add_vents(949,749,636,749);
SELECT add_vents(289,902,142,902);
SELECT add_vents(923,615,123,615);
SELECT add_vents(710,929,541,760);
SELECT add_vents(211,402,211,433);
SELECT add_vents(515,178,533,178);
SELECT add_vents(525,869,525,578);
SELECT add_vents(201,569,17,569);
SELECT add_vents(629,848,882,848);
SELECT add_vents(152,512,152,189);
SELECT add_vents(914,723,764,723);
SELECT add_vents(218,231,721,734);
SELECT add_vents(438,382,846,382);
SELECT add_vents(582,475,582,559);
SELECT add_vents(529,943,529,683);
SELECT add_vents(330,312,59,312);
SELECT add_vents(242,900,862,900);
SELECT add_vents(271,220,271,118);
SELECT add_vents(182,459,182,673);
SELECT add_vents(513,265,513,420);
SELECT add_vents(918,942,378,942);
SELECT add_vents(277,765,812,230);
SELECT add_vents(625,874,219,874);
SELECT add_vents(737,533,644,626);
SELECT add_vents(647,975,152,480);
SELECT add_vents(638,284,785,284);
SELECT add_vents(549,680,549,877);
SELECT add_vents(886,278,372,792);
SELECT add_vents(130,560,516,174);
SELECT add_vents(186,741,186,555);
SELECT add_vents(208,536,469,536);
SELECT add_vents(674,906,312,906);
SELECT add_vents(934,156,934,322);
SELECT add_vents(568,412,214,412);
SELECT add_vents(243,19,243,814);
SELECT add_vents(861,230,104,987);
SELECT add_vents(683,891,683,533);
SELECT add_vents(545,740,545,980);
SELECT add_vents(343,320,796,320);
SELECT add_vents(821,220,821,302);
SELECT add_vents(578,741,578,141);
SELECT add_vents(633,405,27,405);
SELECT add_vents(645,975,225,555);
SELECT add_vents(25,527,412,527);
SELECT add_vents(378,817,378,913);
SELECT add_vents(352,741,352,293);
SELECT add_vents(48,986,925,109);
SELECT add_vents(506,231,491,231);
SELECT add_vents(854,883,48,77);
SELECT add_vents(261,221,895,855);
SELECT add_vents(902,240,902,943);
SELECT add_vents(145,338,770,963);
SELECT add_vents(832,216,832,869);
SELECT add_vents(480,385,324,385);
SELECT add_vents(644,202,433,202);
SELECT add_vents(202,176,190,176);
SELECT add_vents(668,693,668,349);
SELECT add_vents(95,230,143,230);
SELECT add_vents(873,144,67,950);
SELECT add_vents(232,509,238,509);
SELECT add_vents(963,43,133,873);
SELECT add_vents(527,631,641,517);
SELECT add_vents(363,61,849,61);
SELECT add_vents(72,326,72,861);
SELECT add_vents(542,801,233,492);
SELECT add_vents(247,48,247,785);
SELECT add_vents(972,563,480,71);
SELECT add_vents(362,870,932,300);
SELECT add_vents(263,811,263,584);
SELECT add_vents(556,157,417,157);
SELECT add_vents(946,900,175,129);
SELECT add_vents(790,542,530,542);
SELECT add_vents(777,195,154,818);
SELECT add_vents(71,764,71,193);
SELECT add_vents(197,13,453,13);
SELECT add_vents(664,714,158,714);
SELECT add_vents(257,819,257,730);
SELECT add_vents(796,927,688,927);
SELECT add_vents(124,53,954,883);
SELECT add_vents(30,16,980,966);
SELECT add_vents(84,151,597,151);
SELECT add_vents(840,776,684,776);
SELECT add_vents(548,460,718,630);
SELECT add_vents(291,635,291,151);
SELECT add_vents(948,43,58,933);
SELECT add_vents(373,483,373,591);
SELECT add_vents(309,81,259,81);
SELECT add_vents(692,808,692,835);
SELECT add_vents(737,112,215,634);
SELECT add_vents(808,595,808,115);
SELECT add_vents(160,912,973,99);
SELECT add_vents(494,191,494,475);
SELECT add_vents(713,925,43,255);
SELECT add_vents(736,580,290,134);
SELECT add_vents(257,679,725,211);
SELECT add_vents(464,81,712,81);
SELECT add_vents(35,147,35,420);
SELECT add_vents(372,159,372,548);
SELECT add_vents(508,228,682,402);
SELECT add_vents(120,491,518,889);
SELECT add_vents(139,948,272,815);
SELECT add_vents(398,523,398,818);
SELECT add_vents(935,50,40,945);
SELECT add_vents(415,959,195,739);
SELECT add_vents(250,868,250,930);
SELECT add_vents(77,60,917,900);
SELECT add_vents(584,389,493,298);
SELECT add_vents(362,163,362,704);
SELECT add_vents(670,740,670,703);
SELECT add_vents(689,297,689,388);
SELECT add_vents(988,572,988,340);
SELECT add_vents(238,248,238,916);
SELECT add_vents(748,753,29,34);
SELECT add_vents(184,565,184,486);
SELECT add_vents(812,217,812,34);
SELECT add_vents(60,140,96,104);
SELECT add_vents(826,673,230,673);
SELECT add_vents(221,221,207,235);
SELECT add_vents(449,483,270,304);
SELECT add_vents(805,810,805,564);
SELECT add_vents(952,52,139,865);
SELECT add_vents(428,967,312,851);
SELECT add_vents(854,673,661,673);
SELECT add_vents(985,209,853,209);
SELECT add_vents(523,365,54,365);
SELECT add_vents(492,171,646,171);
SELECT add_vents(908,853,69,14);
SELECT add_vents(38,698,724,12);
SELECT add_vents(400,479,167,479);
SELECT add_vents(948,313,948,976);
SELECT add_vents(280,145,37,145);
SELECT add_vents(206,858,683,381);
SELECT add_vents(203,413,545,413);
SELECT add_vents(726,173,673,173);
SELECT add_vents(30,954,150,954);
SELECT add_vents(319,592,870,41);
SELECT add_vents(808,91,180,719);
SELECT add_vents(845,612,972,485);
SELECT add_vents(160,430,160,780);
SELECT add_vents(19,339,379,339);
SELECT add_vents(476,550,476,291);
SELECT add_vents(341,785,229,673);
SELECT add_vents(371,476,371,663);
SELECT add_vents(509,836,412,933);
SELECT add_vents(980,20,31,969);
SELECT add_vents(822,526,328,32);
SELECT add_vents(859,314,425,314);
SELECT add_vents(963,961,963,100);
SELECT add_vents(984,978,31,25);
SELECT add_vents(659,251,619,211);
SELECT add_vents(649,477,846,477);
SELECT add_vents(32,259,724,951);
SELECT add_vents(468,753,468,91);
SELECT add_vents(690,301,690,652);
SELECT add_vents(436,912,845,503);
SELECT add_vents(32,123,576,667);
SELECT add_vents(142,79,741,678);
SELECT add_vents(610,228,468,370);
SELECT add_vents(172,667,172,736);
SELECT add_vents(961,700,132,700);
SELECT add_vents(804,875,804,213);
SELECT add_vents(71,970,340,970);
SELECT add_vents(171,52,149,30);
SELECT add_vents(754,604,226,604);
SELECT add_vents(485,941,27,941);
SELECT add_vents(126,383,328,181);
SELECT add_vents(41,39,987,985);
SELECT add_vents(128,62,896,830);
SELECT add_vents(414,278,923,787);
SELECT add_vents(712,15,712,859);
SELECT add_vents(794,35,200,629);
SELECT add_vents(516,147,402,261);
SELECT add_vents(526,862,905,862);
SELECT add_vents(721,407,721,887);
SELECT add_vents(728,920,339,920);
SELECT add_vents(117,417,203,417);
SELECT add_vents(291,561,17,835);
SELECT add_vents(171,359,837,359);
SELECT add_vents(93,125,136,125);
SELECT add_vents(220,226,220,177);
SELECT add_vents(75,434,75,407);
SELECT add_vents(235,664,141,664);
SELECT add_vents(553,490,566,477);
SELECT add_vents(487,651,487,877);
SELECT add_vents(699,150,933,384);
SELECT add_vents(73,556,453,556);
SELECT add_vents(363,371,363,984);
SELECT add_vents(905,106,668,106);
SELECT add_vents(139,271,139,125);
SELECT add_vents(466,379,466,420);
SELECT add_vents(12,935,625,935);
SELECT add_vents(89,892,779,892);
SELECT add_vents(119,701,270,852);
SELECT add_vents(354,886,80,886);
SELECT add_vents(917,376,440,376);
SELECT add_vents(23,182,794,953);
SELECT add_vents(451,718,121,718);
SELECT add_vents(62,251,62,451);
SELECT add_vents(642,74,642,698);
SELECT add_vents(425,200,442,200);
SELECT add_vents(828,175,828,405);
SELECT add_vents(751,743,591,743);
SELECT add_vents(569,681,574,681);
SELECT add_vents(329,187,329,837);
SELECT add_vents(302,592,302,230);
SELECT add_vents(359,135,386,108);
SELECT add_vents(44,234,44,731);
SELECT add_vents(836,305,836,574);
SELECT add_vents(170,512,367,512);
SELECT add_vents(576,699,576,44);
SELECT add_vents(398,185,821,185);
SELECT add_vents(733,78,733,747);
SELECT add_vents(141,183,141,787);
SELECT add_vents(65,360,65,691);
SELECT add_vents(828,780,828,98);
SELECT add_vents(776,744,776,751);
SELECT add_vents(881,74,481,474);
SELECT add_vents(438,642,438,399);
SELECT add_vents(676,972,175,972);
SELECT add_vents(60,318,56,314);
SELECT add_vents(312,169,341,169);
SELECT add_vents(736,472,392,128);
SELECT add_vents(225,281,164,281);
SELECT add_vents(407,799,341,799);
SELECT add_vents(458,826,983,301);
SELECT add_vents(12,988,987,13);
SELECT add_vents(23,854,662,215);
SELECT add_vents(82,863,82,416);
SELECT add_vents(542,708,542,44);
SELECT add_vents(659,51,520,51);
SELECT add_vents(353,246,353,90);
SELECT add_vents(985,976,77,68);
SELECT add_vents(628,493,628,510);
SELECT add_vents(51,48,635,48);
SELECT add_vents(97,814,828,83);
SELECT add_vents(14,44,773,44);
SELECT add_vents(603,178,597,178);
SELECT add_vents(11,220,783,220);
SELECT add_vents(613,39,613,719);
SELECT add_vents(68,303,690,925);
SELECT add_vents(121,974,896,199);
SELECT add_vents(343,54,343,837);
SELECT add_vents(744,303,744,942);
SELECT add_vents(678,370,246,370);
SELECT add_vents(937,134,84,987);
SELECT add_vents(357,333,357,516);
SELECT add_vents(848,212,429,631);
SELECT add_vents(909,244,138,244);
SELECT add_vents(122,794,786,130);
SELECT add_vents(274,611,57,611);
SELECT add_vents(66,337,385,18);
SELECT add_vents(847,356,831,356);
SELECT add_vents(740,480,740,359);
SELECT add_vents(194,443,194,301);
SELECT add_vents(50,564,572,42);
SELECT add_vents(86,587,774,587);
SELECT add_vents(708,258,49,917);
SELECT add_vents(420,530,277,387);
SELECT add_vents(509,580,509,71);
SELECT add_vents(237,196,479,196);
SELECT add_vents(442,287,850,287);
SELECT add_vents(830,393,532,393);
SELECT add_vents(274,720,501,493);
SELECT add_vents(610,565,218,957);
SELECT add_vents(380,393,380,800);
SELECT add_vents(237,847,155,847);
SELECT add_vents(267,791,52,791);
SELECT add_vents(275,772,275,794);
SELECT add_vents(239,238,419,418);
SELECT add_vents(200,785,884,101);
SELECT add_vents(185,980,185,284);
SELECT add_vents(47,46,750,749);
SELECT add_vents(724,661,724,337);
SELECT add_vents(630,349,666,349);
SELECT add_vents(21,911,21,569);
SELECT add_vents(661,562,661,925);
SELECT add_vents(41,898,41,104);
SELECT add_vents(988,67,105,67);
SELECT add_vents(739,65,868,65);
SELECT add_vents(187,973,809,973);
SELECT add_vents(730,211,255,686);
SELECT add_vents(254,445,254,872);
SELECT add_vents(622,364,235,751);
SELECT add_vents(402,980,761,621);
SELECT add_vents(46,488,960,488);
SELECT add_vents(799,708,799,862);
SELECT add_vents(909,181,909,189);
SELECT add_vents(450,266,450,304);
SELECT add_vents(631,584,631,455);
SELECT add_vents(164,830,744,250);
SELECT add_vents(679,755,690,744);
SELECT add_vents(949,26,190,785);
SELECT add_vents(695,783,218,783);
SELECT add_vents(269,151,40,151);
SELECT add_vents(166,152,22,152);
SELECT add_vents(281,819,922,178);
SELECT add_vents(956,649,956,593);

SELECT * from vents limit 100;

SELECT COUNT(*)
	FROM vents
	WHERE overlap > 0;